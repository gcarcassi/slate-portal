{%extends "base.html"%}

{%block title%}
  Cluster Profile
{%endblock%}

{%block body%}
<section id="cluster-profile" class="bg-light">
  <div class="container col-lg-12 mx-auto">

    <div class="row">
      <div class="col-lg-12 mx-auto">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{{url_for('dashboard')}}">Home</a></li>
          <li class="breadcrumb-item"><a href="{{url_for('list_clusters')}}">Clusters</a></li>
          <li class="breadcrumb-item active">{[{cluster.metadata.name}]}</li>
        </ol>
        <h1>Cluster: {[{cluster.metadata.name}]}</h1>
        <hr/>
        <div class="row">
          <div class="col-sm-6">
            <div class="card h-100">
              <div class="card-header">
                Cluster Information
              </div>
              <div class="card-body">
                <p class="lead">
                  <strong>Administering Group:</strong>
                  {[{cluster.metadata.owningGroup}]}
                </p>
                <p class="lead">
                  <strong>Contact:</strong>
                  <a :href="'mailto:'+owningGroupEmail">{[{owningGroupEmail}]}</a>
                </p>
                <p class="lead">
                  <strong>Organization:</strong>
                  {[{cluster.metadata.owningOrganization}]}
                </p>
                <p class="lead">
                  <strong>Location: {{address}}</strong> 
                </p>
                <p class="lead">
                  <strong>Status: </strong>
                  <span v-if="cluster_status === 'True'">
                    Reachable <i class='fas fa-check-circle' style='color: green'></i>
                  </span>
                  <span v-else>
                    Currently unreachable <i class='fas fa-times-circle' style='color: red'></i>
                  </span>
                </p>
              </div>
            </div>
          </div>

          <div class="col-sm-6">
            <div class="card h-100">
              <div class="card-header">
                Groups with access
              </div>
              <div class="card-body">

                <ul class="list-unstyled" v-if="loading">
                  <li>Loading Data <i class="fas fa-sync fa-spin"></i></li>
                </ul>

                <ul class="list-unstyled" v-if="failed">
                  <li>Failed to load the data, please refresh the page <i class="far fa-times-circle"></i></li>
                </ul>

                <ul class="list-unstyled" id="allowed_groups">
                  <li v-for="(group, index) in allowed_groups">
                    <a v-if="group.metadata.name == '<all>' " :href="'/public_groups'">All Groups</a>
                    <a v-else :href="'/public_groups/' + group.metadata.name">{[{group.metadata.name}]}</a>
                  </li>
                </ul>

              </div>
            </div>
          </div>
        </div>
        <br/>
        <span v-if="['uutah-prod', 'utah-dev', 'umich-prod', 'uchicago-prod'].includes(cluster.metadata.name)">
          <div class="row">
            <div class="col-sm-4">
              <div class="card h-100">
                <div class="card-body">
                <iframe :src="'https://monitoring.umich-prod.slateci.net/d-solo/3T3FQKnZk/slate-cluster-status?orgId=1&from=1583336972691&to=1583358572692&var-cluster='+cluster.metadata.name+'&panelId=10'" width="100%" height="200" frameborder="0"></iframe>
                </div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="card h-100">
                <div class="card-body">
                  <iframe :src="'https://monitoring.umich-prod.slateci.net/d-solo/3T3FQKnZk/slate-cluster-status?orgId=1&var-cluster='+cluster.metadata.name+'&theme=light&panelId=11'" width="100%" height="100%" frameborder="0"></iframe>
                </div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="card h-100">
                <!-- <div class="card-header">
                  Average Uptime
                </div> -->
                <div class="card-body">
                  <iframe :src="'https://monitoring.umich-prod.slateci.net/d-solo/3T3FQKnZk/slate-cluster-status?orgId=1&var-cluster='+cluster.metadata.name+'&panelId=7'" width="100%" height="200" frameborder="0"></iframe>
                </div>
              </div>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-sm-12">
              <div class="card h-100">
                <!--<div class="card-header">
                  Load Monitoring
                </div>-->
                <div class="card-body">
                  <iframe :src="'https://monitoring.umich-prod.slateci.net/d-solo/3T3FQKnZk/slate-cluster-status?orgId=1&var-cluster='+cluster.metadata.name+'&theme=light&panelId=5'" width="100%" height="200" frameborder="0"></iframe>
                </div>
              </div>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-sm-12">
              <div class="card h-100">
                <!--<div class="card-header">
                  Node details
                </div>-->
                <div class="card-body">
                  <iframe :src="'https://monitoring.umich-prod.slateci.net/d-solo/3T3FQKnZk/slate-cluster-status?orgId=1&var-cluster='+cluster.metadata.name+'&theme=light&panelId=3'" width="100%" height="200" frameborder="0"></iframe>
                </div>
              </div>
            </div>
          </div>
        </span>

      </div>
    </div>

  </div>
</section>

<meta id="cluster-data" data-name="{{name}}">
<script>
var cluster = $('#cluster-data').data();
var cluster_name = cluster.name;

$(document).ready(function() {
  new Vue({
    el: '#cluster-profile',
    data () {
      return {
        cluster: {},
        owningGroupEmail: {},
        allowed_groups: {},
        cluster_status: {},
        loading: true,
        failed: false
      }
    },
    mounted() {
      axios.get('/public-clusters-xhr/'+cluster_name)
      .then(function (response) {
        this.cluster = response.data[0];
        this.owningGroupEmail = response.data[1];
        this.allowed_groups = response.data[2];
        this.cluster_status = response.data[3];
        this.loading = false;
        }.bind(this)) //must use bind(this) unless using arrow function
        .catch(error => { this.failed = true; this.loading = false; })
      }
    });
  });
</script>
{%endblock%}
